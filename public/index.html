<!-- TODO: Add guidance circle of play area-->
<!-- TODO: Maybe make higher value balloons smaller in size?-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMD3901B Assignment 2</title>
    <!-- Note: I had to switch to the master version of Aframe to get it to run on my Windows Mixed Reality headset.
        This was the issue I was getting https://github.com/mrdoob/three.js/issues/20715
        While Three.js seemed to have fixed it on their end, Aframe 1.1.0 seems to be broken still, so I have to switch the master/nightly
        dist. I have downloaded the copy of Aframe that worked for me and placed it in the js folder. If performance is siffering due to the
        reliance on a local copy, you can attempt to use the CDN version by uncommenting the link to the CDN below, though note that this may
        break the app due to the master version being updated constantly. 
    -->
    <script src="./js/aframe-master.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.2.0/index.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@a20bae2527c7a97479d7b368507dbd2133f62860/dist/aframe-master.min.js"></script> -->
    <!-- A-frame Extras: https://github.com/n5ro/aframe-extras -->
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <!-- Super Hands: https://github.com/wmurphyrd/aframe-super-hands-component -->
    <script src="https://unpkg.com/super-hands@^3.0.1/dist/super-hands.min.js"></script>
    <script src="./js/lightcube.js"></script>
    <script src="./js/balloon.js"></script>
    <script src="./js/gameRunner.js"></script>
    <script>
        //Lightcube grab/drop
        document.addEventListener('keyup', function(e){
            if (e.keyCode === 69) {
                const heldCube = document.querySelector("a-entity[camera] > a-entity[lightcube]");
                if (heldCube) {
                    let cube = document.createElement('a-entity');
                    //TODO: Get cube to match rotation of where the camera is facing
                    cube.setAttribute('lightcube', {
                        x: document.querySelector("a-entity[camera]").object3D.position.x,
                        y: 0.5,
                        z: document.querySelector("a-entity[camera]").object3D.position.z - 3.0
                    });
                    //Add cube to world
                    document.querySelector("#cubes").appendChild(cube);
                    heldCube.parentNode.removeChild(heldCube);
                }
                let closest = undefined;
                document.querySelectorAll("a-entity .lightcube").forEach(element => {
                    intersection = document.querySelector("a-entity[raycaster]").components.raycaster.getIntersection(element);
                    if (intersection){
                        if (closest === undefined || intersection.distance < closest.distance){
                            closest = intersection;
                        }
                    }
                });
                if (closest){
                closest.object.el.components.lightcube.data.moveTowards = true;
                }
            }
        });
    </script>
</head>
<body>
    <a-scene>
        <!-- Assets -->
        <a-assets>
            <!-- TODO: Need to change this sound and add background music-->
            <!--
                Inspired by Kevin MacLeod
                Link: https://incompetech.filmmusic.io/song/3918-inspired
                License: https://filmmusic.io/standard-license
            -->
            <audio id="background_music" src="./assets/background.mp3" preload="auto" crossorigin="anonymous"></audio>
            <!-- "Party Pack, Balloons, Popping, 02-01.wav" by InspectorJ (www.jshaw.co.uk) of Freesound.org (www.freesound.org)-->
            <audio id="pop_sound" src="./assets/ding.mp3" preload="auto" crossorigin="anonymous"></audio>
        </a-assets>

        <!-- Preloading sound -->
        <a-entity id="pop" sound="src:#pop_sound"></a-entity>
        <a-entity sound="src:#background_music; autoplay:true; volume:0.5; loop:true;"></a-entity>

        <!-- Camera -->
        <a-entity camera wasd-controls look-controls position="0 2.2 6">
            <!-- Desktop/Mobile pointer-->
            <a-entity 
                cursor="rayOrigin:mouse"
                raycaster="far:20; interval:100; objects:.interactive">
            </a-entity>
        </a-entity>

        <!-- VR Controller -->
        <!-- TODO: Add a component that switches which hand is active-->
        <!-- TODO: Add custom controller model-->
        <!-- https://aframe.io/docs/1.1.0/introduction/interactions-and-controllers.html#creating-custom-controllers -->
        <a-entity 
            laser-controls="hand:right;" 
            raycaster="far:20; interval:100; objects:.interactive">
        </a-entity>

        <!-- Environment-->
        <a-entity environment="preset:checkerboard"></a-entity>

        <!-- Start/Restart button-->
        <a-entity id="button_universal">
            <!-- Button pillar -->
            <a-entity 
                geometry="primitive:box; width:0.5; depth:0.5; height:2;" 
                position="0 0.3 0" 
                material="color:white;">
            </a-entity>
            <!-- Button -->
            <a-entity 
                gamerunner 
                id="gamerunner"
                class="button interactive"
                geometry="primitive:cylinder; radius:0.15; height:0.2;" 
                position="0 1.3 0" 
                material="color:rgb(255, 100, 100);"
                animation__mouseenter="property:material.color; type:color; to:rgb(255, 0, 0); dur:200; startEvents:mouseenter;"
                animation__mouseleave="property:material.color; type:color; to:rgb(255, 100, 100); dur:200; startEvents:mouseleave;"
                animation__click="property:position.y; from:1.3; to:1.25; dur:400; startEvents:click; dir:reverse;">
            </a-entity>
            <!-- Front-facing start text-->
            <!-- Font is Pree Start 2P by CodeMan38. Found here: https://fonts.google.com/specimen/Press+Start+2P Licensed under the Open Font License. Full copyright notice can be found in ./font/OFL.txt-->
            <a-entity 
                class="gameText"
                text="align: center; value: Start Balloons; width: 10; color: white;" 
                position="0 2 0">
            </a-entity>
            <!-- Back facing start text-->
            <a-entity 
                class="gameText"
                text="align: center; value: Start Balloons; width: 10; color: white;"
                position="0 2 0"
                rotation="0 180 0">
            </a-entity>
        </a-entity>

        <!-- Balloons -->
        <!-- TODO: Add randomization of color and position. Also points?-->
        <a-entity id="balloons">
        </a-entity>
    </a-scene>
</body>
</html>
